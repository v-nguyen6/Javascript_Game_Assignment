<!doctype html>
<html lang = "en">
<!-- 	
    author: mina, vinson
    date: 2020-11-24
    title: twd - javascript game - html
-->
<head>
    <meta charset = "utf-8">
    <meta name = "viewport"                         content = "width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible"              content="ie=edge">
    <title>dino dash</title>

    <link rel = "stylesheet"                        href = "styles/styles-v2.css">
    <link rel="preconnect"                          href="https://fonts.gstatic.com">

    <link rel="stylesheet"                          href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-57x57.png"    sizes="57x57" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-114x114.png"  sizes="114x114" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-72x72.png"    sizes="72x72" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-144x144.png"  sizes="144x144" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-60x60.png"    sizes="60x60" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-120x120.png"  sizes="120x120" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-76x76.png"    sizes="76x76" />
    <link rel="apple-touch-icon-precomposed"        href="images/favicomatic/apple-touch-icon-152x152.png"  sizes="152x152" />
    <link rel="icon" type="image/png"               href="images/favicomatic/favicon-196x196.png"           sizes="196x196" />
    <link rel="icon" type="image/png"               href="images/favicomatic/favicon-96x96.png"             sizes="96x96" />
    <link rel="icon" type="image/png"               href="images/favicomatic/favicon-32x32.png"             sizes="32x32" />
    <link rel="icon" type="image/png"               href="images/favicomatic/favicon-16x16.png"             sizes="16x16" />
    <link rel="icon" type="image/png"               href="images/favicomatic/favicon-128.png"               sizes="128x128" />
    <meta name="application-name"                   content="&nbsp;"/>
    <meta name="msapplication-TileColor"            content="#FFFFFF" />
    <meta name="msapplication-TileImage"            content="mstile-144x144.png" />
    <meta name="msapplication-square70x70logo"      content="mstile-70x70.png" />
    <meta name="msapplication-square150x150logo"    content="mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo"      content="mstile-310x150.png" />
    <meta name="msapplication-square310x310logo"    content="mstile-310x310.png" />
</head>
<!--=======================================================================================================-->
<body id="theBody" class="theBody">

<div id="game-start-screen" class="game-start-screen">
    <div id="startScreenDiv" class="startScreenDiv">
        <h1>Dino Dash</h1>
        <h3>&#x2039; Your Mission &#x203A;</h3>
        <p>Just another day in the Mesozoic era... <br> Help your buddy cross the forest by avoiding obstacles.</p>
        <h3>&#x2039; Controls &#x203A;</h3>
        <p>&#8592; &#8595; &#8594; keys to move and &#8593; to jump.</p>
        <button id="startButton" class="startButton">Start</button>
    </div>
</div>

<div id="funButtonsDiv" class="funButtonsDiv">
    <button id="darkModeButton" class="darkModeButton" title="dark mode">On</button>
    <button id="partyModeButton" class="partyModeButton" title="warning: flashing lights">Party Time?</button>
</div>
<div id="gameOverMessage" class="gameOverMessage">
    <h3>Game Over &#9785;</h3>
    <button id="startOverButton" class="startOverButton">Try Again?</button>
</div> 

<!--=======================================================================================================-->

<script>                                                               // made with the help of W3Schools :)
// PART 1 - buttons!!!

// close window when button is pressed
const startButton = document.getElementById("startButton");
const gameStartScreen = document.getElementById("game-start-screen");
const startOverButton = document.getElementById("startOverButton");
const gameOverMessage = document.getElementById("gameOverMessage");
const darkModeButton = document.getElementById("darkModeButton");
const partyModeButton = document.getElementById("partyModeButton");
const theBody = document.getElementById("theBody");

// when window loads, hide the "gameOverMessage" div.
window.onload = function() {
    document.getElementById('gameOverMessage').style.display = 'none';
};

// when user clicks "confirm selection", start game
startButton.addEventListener('click', function(){
    gameStartScreen.style.display = "none";
    startGame();
});

// when user clicks "start over? :(", restart game
startOverButton.addEventListener('click', function(){
    gameOverMessage.style.display = "none";
    window.location.reload();
});

// when user clicks dark mode button, change background to black (and vice versa)
darkModeButton.addEventListener('click', function() {
    theBody.classList.toggle('dark-theme')
    if (darkModeButton.innerHTML == "On") {
        darkModeButton.innerHTML = "Off";
    } else {
        darkModeButton.innerHTML = "On";
    }
});

// when user clicks party mode button, change background to strobe lights until toggled off
partyModeButton.addEventListener('click', function() {
    theBody.classList.toggle('party-theme')
    if (partyModeButton.innerHTML == "Party Time?") {
        partyModeButton.innerHTML = "Party Time!!!";
    } else {
        partyModeButton.innerHTML = "Party Time?";
    }
});

// =======================================================================================================
// PART 2

var myGamePiece;
var myObstacle;
var myObstacles = [];
var myScore;
var myScoreBG;
var myBackground;

// create the components - game area, player, score, music, obstacles...
function startGame() {
    myGamePiece = new component(60, 40, "/images/dinosaur_1_green_final.png", 50, 350, "image"); 
    myScore = new component("30px", "VT323", "white", 30, 50, "text");
    myScoreBG = new component(190, 28, "#282830", 25, 28);
    myObstacle = new component(50, 50, "/images/obstacle2.png", 300, 120, "image"); 
    myBackground = new component(756, 445, "/images/tree_background-1.png", 0, 0, "background");
    myGameArea.start();
}

var myGameArea = {
    // create the canvas component (the game area)
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 756;
        this.canvas.height = 445;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;       
        // update the display every 20ms by adding an interval to function every 20ms
        this.interval = setInterval(updateGameArea, 20);
        // check if keys are pressed by checking key code => insert an element when key is pressed
        window.addEventListener('keydown', function (e) {
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        });
        // if key is no longer pressed...
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = (e.type == "keydown");            
        });
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
};

// function used to update and loop through the frames of the animation 
function everyinterval(n) {
  if ((myGameArea.frameNo / n) % 1 == 0) {
      return true;
    }
  return false;
}

// =======================================================================================================
// PART 3 - COMPONENT CONSTRUCTOR FUNCTION

function component(width, height, color, x, y, type) {
    this.gamearea = myGameArea;
    this.type = type;
    if (type == "image" || type == "background") {
        this.image = new Image();
        this.image.src = color;
    }
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.gravity = 0.05; 
    this.gravitySpeed = 0;
    this.x = x;
    this.y = y;    
    // handles drawing of component
    this.update = function() {      
        var ctx;
        ctx = myGameArea.context;
        // check if component is "image" or "background" type
        if (type == "image" || type == "background") {
            ctx.drawImage(this.image, this.x, this.y, this.width, this.height); 
            if (type == "background") {
                ctx.drawImage(this.image, this.x + this.width, this.y, this.width, this.height);
            }
        // test if component is "text" type
        } else if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
        } 
        else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    };

    // changes the component's position
    this.newPos = function() {
        this.gravitySpeed += this.gravity;              // gravity effects on the position components
        this.x += this.speedX;                          // updates for x position 
        this.y += this.speedY + this.gravitySpeed;      // gravity effects on the y coordinates 
        
        // background looping 
        if (this.type == "background") {
            if (this.x == -(this.width)) {
                this.x = 0;
            }
        } 
        this.hitBottom();                        // component to notify and detect when player hits the bottom 
        this.hitRight();                         // component to notify and detect when player hits the right
        //this.hitLeft();                        // component to notify and detect when player hits the left  
    }

    // function to detect when player lands on the bottom of the canvas 
    this.hitBottom = function() {
        var bottomScreen = myGameArea.canvas.height - this.height;  // variable to assign bottom of canvas 
        if (this.y > bottomScreen) {                                // if statement for detection
            this.y = bottomScreen;                                  // if the bottom(y) of player is equal to bottom of the screen
            this.gravitySpeed = 0;                                  // then stop player from moving (gravity = 0)
        }
    };

    // function to detect when player hits right of canvas
    this.hitRight = function() {
        var rightScreen = myGameArea.canvas.width - this.width;
        if (this.x > rightScreen) {
            this.x = rightScreen;
        }
    };

    /* ----- WHY DOES THIS BREAKK OUr BG ANIMATION1?!?!
    // function to detect when player hits left of canvas
    this.hitLeft = function() {
        var leftScreen = myGameArea.canvas.width - myGameArea.canvas.width;
        if (this.x < leftScreen) {
            this.x = leftScreen;
        }
    }
    */

    function accelerate(n) {
        myGamePiece.gravity = n;
    }

    this.crashWith = function(otherobj) {
        var myleft = this.x;
        var myright = this.x + (this.width);
        var mytop = this.y;
        var mybottom = this.y + (this.height);
        var otherleft = otherobj.x;
        var otherright = otherobj.x + (otherobj.width);
        var othertop = otherobj.y;
        var otherbottom = otherobj.y + (otherobj.height);
        var crash = true;
        if ((mybottom < othertop) ||
            (mytop > otherbottom) ||
            (myright < otherleft) ||
            (myleft > otherright)) {
                crash = false;
        }
        return crash;
    };
}

// =======================================================================================================
// PART 4

// calling clear() and update()
function updateGameArea() {
    //var x,y;
    var x, y, height, minHeight, maxHeight, i;
    for (i = 0; i < myObstacles.length; i += 1) {
        // when player runs into obstacles, end the game and display "game over" message
        if (myGamePiece.crashWith(myObstacles[i])) {
            myGameArea.stop();
            document.getElementById('gameOverMessage').style.display = 'block';
            return;
        }
    }
    myGameArea.clear();
    myBackground.speedX = -1;       // background looping update
    myBackground.newPos();    
    myBackground.update();
    myGameArea.frameNo += 1;        // count the score with frameNo

    // send in obstacles of random sizes (need to work on this)
    if (myGameArea.frameNo == 1 || everyinterval(150)) {
        x = myGameArea.canvas.width;
        minHeight = 350;
        maxHeight = 450;
        height = Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
        myObstacles.push(new component(50, x-height, "/images/obstacle2.png", x, height, "image"));
    }
    for (i = 0; i < myObstacles.length; i += 1) {
        myObstacles[i].x += -3;
        myObstacles[i].update();
    }

    myGamePiece.speedX = 0;
    myGamePiece.speedY = 0;
    
    // move player when arrow keys are pressed
    if (myGameArea.keys && myGameArea.keys[37]) {       // left arrow key
        myGamePiece.speedX = -2; 
    }
    if (myGameArea.keys && myGameArea.keys[39]) {       // right arrow key
        myGamePiece.speedX = 2; 
    }
    if (myGameArea.keys && myGameArea.keys[38]) {       // top arrow key
        myGamePiece.speedY = -4; 
    }
    if (myGameArea.keys && myGameArea.keys[40]) {       // bottom arrow key
        myGamePiece.speedY = 2;
    }
    myGamePiece.newPos();                               // update player position
    myGamePiece.update();
    myScore.text = "DINO-SCORE: " + myGameArea.frameNo; // update score
    myScoreBG.update();
    myScore.update();
}

</script>
<footer>&copy; 2020 - Present. A Javascript Game by <a href="http://mbui.bcitwebdeveloper.ca/">Mina Bui</a> and <a href="http://vnguyen.bcitwebdeveloper.ca/">Vinson Nguyen</a>. </footer>
</body>
</html>